# RISC-V 编译器的基本结构和工作原理

本期视频中我们详细学习一下RISC-V 编译器的基本结构和工作原理。

首先，编译器接收源代码。源代码通过编译器的第一阶段：词法分析。

## 词法分析

词法分析器将源代码分解为一系列Token，这些Token是代码的最小单元，如关键字、变量名、运算符等。

比如：

```c
int result = a + b * 10;
```

这其中的 token 包括：

int：关键字；

result a b：标识符；

+=*：操作符；

10：立即数；

;：分隔符。

有助于后续生成结构化语法分析。

## 语法分析

接着，语法分析器会检查这些Token的结构是否符合编程语言的语法规则，并生成一棵语法树，表示代码的层次关系。

leetcode常见题型：前后序表达式。

## 编译优化

### 常量折叠

常量折叠是将编译时能够确定值的表达式计算出来。例如：

```
c
复制代码
int x = 3 * 5;
```

编译器会直接将 `3 * 5` 计算为 `15`，从而减少运行时的计算。

### 死代码消除

死代码消除会删除那些在程序执行过程中永远不会被执行的代码。例如：

```
c复制代码if (false) {
    printf("This will never be printed.");
}
```

因为 `if` 条件永远为 `false`，编译器会去掉这个分支中的代码。

### 循环优化

循环优化是一种通过减少循环中的不必要计算和操作来提高效率的技术。常见的优化包括循环展开和循环不变代码外提。例如，将循环内不变的表达式移到循环外部以减少重复计算。

### 寄存器分配

编译器还会尝试优化寄存器的使用，尽量减少对内存的访问，因为寄存器的读写速度比内存快得多。通过分析代码的使用情况，编译器可以将频繁使用的变量分配到寄存器中。

### 内联展开

内联展开是一种将小函数的代码直接嵌入到调用点的优化方式。这样可以减少函数调用的开销，但可能会增加可执行文件的大小。

## 代码生成

最后，代码生成器会将语法树转换为汇编代码，再通过汇编器将其转为RISC-V架构的机器码。这个机器码就是最终的可执行程序。